---
title: base64 编码原理
date: 2022-05-05 15:30:32
tags: 前端
---

##### 写在前面

base64 已经成为网络上常见的传输 8Bit 字节代码的编码方式之一。现代浏览器都已经支持原生的基于 base64 的 encode 和 decode，例如 **btoa** 和 **atob**

### 由来

之前网络传送渠道并不支持所有的字节，例如邮件只支持可见字符的传送，后来中文、日文等也有需求了；比如图片。要把不可打印的字符也能用可打印字符来表示，问题就能解决了，Base64 编码应运而生

其实除了 base64 数据编码，还有 base32、base16，64 就是 64 个字符的意思。

<!-- more -->

1. 大小写字母 a-z：52
2. 数字 0-9：10
3. - /：2

52 + 10 + 2 = 64

### 优缺点

**优点**

1. 可以讲二进制数据（如图片）转化为可打印字符，方便数据传输
2. 对数据进行简单的加密，肉眼是安全的
3. 减少 http 请求

**缺点**

1. 内容编码后体积变大，至少 1/3（下面原理会讲
2. 编码和解码需要额外工作量

### 原理

使用 base64 时都会先定义一个类似的数组，下述 64 个字符用 6 个 bit 位就可以表示，一个字节有 8 个 bit 位，剩下两个就浪费掉了，不得不牺牲一部分空间了。

```jsx
["A", "B", "C", ..."a", "b", ..."0", "1", ..."+", "/"];
// A-Z a-z 0-9 + / 64 个可打印字符
```

![figure](1.png)

### 转换步骤

1. 将待转换的字符每三个字节分为一组，每个字节占 8bit，那么共有 24 个二进制位
2. 将上面的 24 个二进制位每 6 个一组，分为 4 组
3. 每组前面添加两个 0，每组由 6 个变为 8 个二进制位，总共 32 个二进制位，4 个字节
4. 根据 base64 编码对照表获得相应的值

比如字符串 “Man”，

1. M、a、n 对应的表里（ascii 码值）的值为 77、97、110，对应二进制值为 01001101、01100001、01101110
2. 如图红色框，将 24 位每 6 位二进制位一组分为四组

![figure](2.png)

3. 每组补 0，扩展位 32 个二进制位，此时变为四个字节：00010010、00010110、00000101、00101110，对应 ascii 码值为：19、22、5、46
4. 在表中查找，分别对应 T、W、F、u。因此 “Man” 编码之后为：”TWFu“

### 汉字情况

在转码前需要对 unicode 转码，js 中如 encodeURIComponent

```jsx
var str = "China，中国";

window.btoa(window.encodeURIComponent(str));
// "Q2hpbmElRUYlQkMlOEMlRTQlQjglQUQlRTUlOUIlQkQ="

window.decodeURIComponent(
  window.atob("Q2hpbmElRUYlQkMlOEMlRTQlQjglQUQlRTUlOUIlQkQ=")
);
// "China，中国"
```

### 位数不足的情况

因为转换是每三个字节一组，必定存在只剩一个字节或者两个字节的情况，如果字节数不够，需要做向后补 0 处理，若 8bit 位全是 0，即表中无值，则用 “=” 字符作为填充字符补上

![figure](3.png)
